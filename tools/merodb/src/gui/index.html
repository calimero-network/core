<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive RocksDB Database Viewer with JQ Query Support">
    <title>MeroDB Inspector</title>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/jq-web@0.6.2/jq.js" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/json-viewer.css">
    <link rel="stylesheet" href="/static/css/jq-panel.css">
    <link rel="stylesheet" href="/static/css/visualization.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1 class="app-header__title">MeroDB Inspector</h1>
            <p class="app-header__subtitle">Interactive RocksDB Database Viewer with JQ Query Support</p>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Upload View -->
            <div id="upload-view" class="upload-container">
                <div class="form-container">
                    <div class="form-container__icon">üìä</div>
                    <h2 class="form-container__title">Load Database</h2>
                    <p class="form-container__description">Specify the database path and optionally upload a WASM file for state decoding</p>

                    <form id="load-form" class="form">
                        <div class="form-group">
                            <label for="db-path-input" class="form-group__label">Database Path</label>
                            <input
                                type="text"
                                id="db-path-input"
                                class="input"
                                placeholder="/path/to/database"
                                required
                                aria-label="Database path"
                            >
                        </div>

                        <div class="form-group">
                            <label for="wasm-input" class="form-group__label">WASM File (Optional)</label>
                            <div>
                                <label for="wasm-input" class="file-button">Choose File</label>
                                <input
                                    type="file"
                                    id="wasm-input"
                                    class="input--hidden"
                                    accept=".wasm"
                                    aria-label="WASM file"
                                >
                                <span id="wasm-filename" class="file-button__filename">No file chosen</span>
                            </div>
                        </div>

                        <button type="submit" id="load-button" class="btn btn--primary">Load Database</button>
                    </form>

                    <div id="loading-message" class="message message--loading hidden">
                        <span class="spinner">‚è≥</span> Loading database...
                    </div>

                    <div id="error-message" class="message message--error hidden" role="alert"></div>
                    <div id="warning-message" class="message message--warning hidden" role="alert"></div>
                    <div id="info-message" class="message message--success hidden" role="status"></div>
                </div>
            </div>

            <!-- Viewer View -->
            <div id="viewer-view" class="viewer-container hidden">
                <!-- File Info Bar -->
                <div class="file-info">
                    <span class="file-info__name" id="current-db-path"></span>
                    <button class="btn btn--secondary" id="reload-button">Reload Database</button>
                </div>

                <!-- Tab Navigation -->
                <nav class="tabs" role="tablist">
                    <button class="tabs__button tabs__button--active" data-tab="data" role="tab" aria-selected="true">Data View</button>
                    <button class="tabs__button" data-tab="dag" role="tab" aria-selected="false">DAG View</button>
                    <button class="tabs__button" data-tab="state" role="tab" aria-selected="false">State Tree</button>
                </nav>

                <!-- Data Tab -->
                <div id="data-view" class="content-panels" role="tabpanel">
                    <div class="content-panels__panel">
                        <h3 class="content-panels__title">JSON Data</h3>
                        <div id="json-viewer" class="json-viewer" role="region" aria-label="JSON data viewer"></div>
                    </div>

                    <div class="content-panels__panel">
                        <h3 class="content-panels__title">JQ Query</h3>

                        <div class="jq-panel__input-container">
                            <label class="jq-panel__label" for="jq-query">Query</label>
                            <div class="jq-panel__input-row">
                                <input
                                    type="text"
                                    id="jq-query"
                                    class="jq-panel__input"
                                    placeholder=". | keys"
                                    aria-label="JQ query input"
                                >
                                <button id="run-query" class="jq-panel__run-button">Run</button>
                            </div>
                        </div>

                        <div class="jq-panel__section">
                            <label class="jq-panel__label">Examples</label>
                            <div id="examples" class="jq-panel__buttons"></div>
                        </div>

                        <div class="jq-panel__section">
                            <label class="jq-panel__label">History</label>
                            <div id="history" class="jq-panel__buttons"></div>
                        </div>

                        <div class="jq-panel__result-container">
                            <label class="jq-panel__label">Result</label>
                            <div id="result" class="jq-panel__result-content" role="region" aria-live="polite">
                                <div class="jq-panel__result-placeholder">
                                    Run a query to see results
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DAG Tab -->
                <div id="dag-view" class="visualization-container hidden" role="tabpanel">
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-group__label" for="context-select">Context:</label>
                            <select id="context-select" class="control-group__select" aria-label="Select context">
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-group__label" for="layout-select">Layout:</label>
                            <select id="layout-select" class="control-group__select" aria-label="Select layout type">
                                <option value="hierarchical">Hierarchical</option>
                                <option value="force">Force-Directed</option>
                            </select>
                        </div>
                        <button class="btn btn--control" id="reset-zoom">Reset Zoom</button>
                        <button class="btn btn--control" id="export-dag">Export Image</button>
                    </div>

                    <div id="dag-stats" class="stats"></div>
                    <div class="hint" style="font-size: 12px; color: #888; padding: 8px 0;">
                        üí° Tip: Hold <kbd>Ctrl</kbd> (or <kbd>Cmd</kbd> on Mac) and hover over a node to pin its tooltip. Pinned tooltips can be dragged and closed with the √ó button.
                    </div>
                    <svg id="dag-svg" class="visualization__svg" role="img" aria-label="DAG visualization"></svg>
                    <div id="dag-tooltip" class="tooltip hidden" role="tooltip"></div>
                </div>

                <!-- State Tree Tab -->
                <div id="state-view" class="visualization-container hidden" role="tabpanel">
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-group__label" for="state-context-select">Context:</label>
                            <select id="state-context-select" class="control-group__select" aria-label="Select context">
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-group__label" for="state-layout-select">Layout:</label>
                            <select id="state-layout-select" class="control-group__select" aria-label="Select layout type">
                                <option value="tree">Tree</option>
                                <option value="radial">Radial</option>
                            </select>
                        </div>
                        <button class="btn btn--control" id="reset-state-zoom">Reset Zoom</button>
                        <button class="btn btn--control" id="expand-all">Expand All</button>
                        <button class="btn btn--control" id="collapse-all">Collapse All</button>
                        <button class="btn btn--control" id="export-state">Export Image</button>
                    </div>

                    <div id="state-loading" class="message message--loading hidden">
                        <span class="spinner">‚è≥</span> Loading state tree...
                    </div>
                    <div id="state-error" class="message message--error hidden" role="alert"></div>
                    <div id="state-stats" class="stats"></div>
                    <div class="hint" style="font-size: 12px; color: #888; padding: 8px 0;">
                        üí° Tip: Hold <kbd>Ctrl</kbd> (or <kbd>Cmd</kbd> on Mac) and click a node to pin its tooltip. Pinned tooltips can be dragged and closed with the √ó button.
                    </div>
                    <svg id="state-svg" class="visualization__svg" role="img" aria-label="State tree visualization"></svg>
                    <div id="state-tooltip" class="tooltip hidden" role="tooltip"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Application Scripts (ES6 Modules) -->
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>
