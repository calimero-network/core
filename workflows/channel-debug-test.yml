name: Channel Debug Test Workflow
description: Test workflow for Channel Debug application with 1 node

nodes:
  chain_id: testnet-1
  count: 1
  image: localhost:5001/merod-sdk-test-debug:latest
  prefix: calimero-node

steps:
  # Step 1: Install the application on the first node
  - name: Install Application on Node 1
    type: install_application
    node: calimero-node-1
    path: ./apps/channel-debug/res/channel_debug.wasm
    dev: true
    outputs:
      app_id: applicationId

  # Step 2: Create a context using the installed application
  - name: Create Context on Node 1
    type: create_context
    node: calimero-node-1
    application_id: '{{app_id}}'
    params: '{"name": "ChannelDebugTest","is_dm": false, "default_channels": [],"created_at": 1751952997, "owner_username": "Alice"}'
    outputs:
      context_id: contextId
      member_public_key: memberPublicKey
    
  # Step 3: Wait for identity creation to complete
  - name: Wait for Identity Creation
    type: wait
    seconds: 10

  # Step 4: Test the simplest possible method first
  - name: Test Hello Method
    type: call
    node: calimero-node-1
    context_id: '{{context_id}}'
    executor_public_key: '{{member_public_key}}'
    method: hello
    args: {}
    outputs:
      hello_result: result

  # Step 5: Test method with same parameters but no complex logic
  - name: Test Parameters Method
    type: call
    node: calimero-node-1
    context_id: '{{context_id}}'
    executor_public_key: '{{member_public_key}}'
    method: test_params
    args:
      name: "general"
      channel_type_str: "Public"
      description: "General discussion channel"
      created_by: "Alice"
    outputs:
      test_params_result: result

  # Step 6: Test raw storage operations
  - name: Test Raw Storage
    type: call
    node: calimero-node-1
    context_id: '{{context_id}}'
    executor_public_key: '{{member_public_key}}'
    method: test_raw_storage
    args: {}
    outputs:
      raw_storage_result: result

  # Step 7: Test add_channel step by step (string-based)
  - name: Test Add Channel Step by Step
    type: call
    node: calimero-node-1
    context_id: '{{context_id}}'
    executor_public_key: '{{member_public_key}}'
    method: test_add_channel_step_by_step_string
    args:
      name: "step_test"
      channel_type_str: "Public"
      description: "Testing step by step"
      created_by: "test_user"
    outputs:
      step_by_step_result: result

  # Step 7: Wait a moment for operations to complete
  - name: Wait for Operations
    type: wait
    seconds: 5

  # Step 8: Get all channels from Node 1 using the complex curb method
  - name: Get Channels from Node 1
    type: call
    node: calimero-node-1
    context_id: '{{context_id}}'
    executor_public_key: '{{member_public_key}}'
    method: get_channels_curb
    args: {}
    outputs:
      channels: channels

# Configuration options
stop_all_nodes: true
restart: false
wait_timeout: 120
