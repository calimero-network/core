#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "Running pre-commit hook..."

# Check for changes in Markdown or MDX files
if git diff --cached --name-only | grep -q '\.mdx?$'; then
  echo "Markdown or MDX files have been changed."
  pnpm format:md
fi

# Check for changes in Rust files
changed_rust_files=$(git diff --cached --name-only | grep -E '\.rs$' || echo "" )
if [ -n "${changed_rust_files}" ]; then
  echo "Running checks for the Rust code..."
  cargo +nightly fmt
  # Run tests only for the changed files
  ./scripts/test.sh --local ${changed_rust_files}
fi

# Check for changes in the 'node-ui' directory (Next.js app)
if git diff --cached --name-only | grep -q '^node-ui/'; then
  echo "Running checks for the node-ui (Next.js app)..."
  (cd node-ui && pnpm prettier && pnpm lint:fix)
fi

# Check for changes in the 'packages/calimero-sdk' directory
if git diff --cached --name-only | grep -q '^packages/calimero-sdk/'; then
  echo "Running checks for the packages/calimero-sdk..."
  (cd packages/calimero-sdk && pnpm prettier && pnpm lint:fix)
fi
