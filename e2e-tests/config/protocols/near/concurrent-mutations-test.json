{
  "steps": [
    {
      "applicationInstall": {
        "application": {
          "localFile": "./apps/kv-store/res/kv_store.wasm"
        },
        "target": "allMembers"
      }
    },
    {
      "contextCreate": null
    },
    {
      "contextCreateAlias": {
        "aliasName": "concurrent_test"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for broadcast propagation (~6ms measured, 200ms for safety)"
        ]
      }
    },
    {
      "contextInviteJoin": null
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 2000,
        "description": [
          "Wait for mesh formation + sync (~6ms measured, 1000ms for mesh + cascade)"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "initial",
          "value": "synced"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Set initial value on inviter to establish baseline state"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for broadcast propagation (~6ms measured, 200ms for safety)"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "initial"
        },
        "expectedResultJson": "synced",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify all nodes have synced the initial value"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "test_key",
          "value": "from_inviter"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Concurrent mutation test: Inviter sets value"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "test_key",
          "value": "from_invitee"
        },
        "expectedResultJson": null,
        "target": "invitees",
        "description": [
          "Concurrent mutation test: Invitees set DIFFERENT value WITHOUT waiting for inviter's change",
          "This creates concurrent DAG branches that must converge"
        ]
      }
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 2000,
        "description": [
          "Wait for mesh formation + sync (~6ms measured, 1000ms for mesh + cascade)"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "test_key"
        },
        "expectedResultJson": null,
        "target": "allMembers",
        "retries": 10,
        "intervalMs": 1000,
        "description": [
          "Verify all nodes converged to the SAME value",
          "The value depends on CRDT merge resolution (LWW based on HLC)",
          "Using null expected result because we just want to verify consistency across nodes"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "final",
          "value": "done"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Final write after convergence to verify system is still operational"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for broadcast propagation (~6ms measured, 200ms for safety)"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "final"
        },
        "expectedResultJson": "done",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify final write succeeded on all nodes"
        ]
      }
    }
  ]
}
