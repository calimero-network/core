{
  "steps": [
    {
      "applicationInstall": {
        "application": {
          "localFile": "./apps/collaborative-editor/res/collaborative_editor.wasm"
        },
        "target": "allMembers"
      }
    },
    {
      "contextCreate": null
    },
    {
      "contextCreateAlias": {
        "aliasName": "collaborative_editor_test"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for context initialization to complete"
        ]
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "",
        "target": "inviter",
        "description": [
          "Verify document starts empty"
        ]
      }
    },
    {
      "call": {
        "methodName": "get_title",
        "argsJson": {},
        "expectedResultJson": "Untitled Document",
        "target": "inviter",
        "description": [
          "Verify default title"
        ]
      }
    },
    {
      "call": {
        "methodName": "insert_text",
        "argsJson": {
          "position": 0,
          "text": "Hello"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "Hello",
        "target": "inviter",
        "description": [
          "Verify insert on inviter"
        ]
      }
    },
    {
      "call": {
        "methodName": "get_length",
        "argsJson": {},
        "expectedResultJson": 5,
        "target": "inviter"
      }
    },
    {
      "contextInviteJoin": null
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 2000,
        "description": [
          "Wait for gossipsub mesh formation + initial sync completion"
        ]
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "Hello",
        "target": "allMembers",
        "retries": 30,
        "intervalMs": 2000,
        "description": [
          "Verify all nodes synced 'Hello'"
        ]
      }
    },
    {
      "call": {
        "methodName": "insert_text",
        "argsJson": {
          "position": 5,
          "text": "World"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Append 'World' to get 'HelloWorld'"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "HelloWorld",
        "target": "inviter",
        "description": [
          "Verify on inviter only (immediate)"
        ]
      }
    },
    {
      "call": {
        "methodName": "insert_text",
        "argsJson": {
          "position": 10,
          "text": "!"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "HelloWorld!",
        "target": "inviter",
        "description": [
          "Verify on inviter only"
        ]
      }
    },
    {
      "call": {
        "methodName": "delete_text",
        "argsJson": {
          "start": 5,
          "end": 10
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Delete 'World' to get 'Hello!'"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "Hello!",
        "target": "inviter",
        "description": [
          "Verify delete on inviter only"
        ]
      }
    },
    {
      "call": {
        "methodName": "replace_text",
        "argsJson": {
          "start": 0,
          "end": 5,
          "text": "Goodbye"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "Replace 'Hello' with 'Goodbye'"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "Goodbye!",
        "target": "inviter",
        "description": [
          "Verify replace on inviter only"
        ]
      }
    },
    {
      "call": {
        "methodName": "set_title",
        "argsJson": {
          "new_title": "Test Document"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_title",
        "argsJson": {},
        "expectedResultJson": "Test Document",
        "target": "inviter",
        "description": [
          "Verify title change on inviter only"
        ]
      }
    },
    {
      "call": {
        "methodName": "clear",
        "argsJson": {},
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "",
        "target": "inviter",
        "description": [
          "Verify clear on inviter only"
        ]
      }
    },
    {
      "call": {
        "methodName": "is_empty",
        "argsJson": {},
        "expectedResultJson": true,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 3000,
        "description": [
          "Final wait to ensure all deltas propagated to all nodes"
        ]
      }
    },
    {
      "call": {
        "methodName": "get_text",
        "argsJson": {},
        "expectedResultJson": "",
        "target": "allMembers",
        "retries": 20,
        "intervalMs": 2000,
        "description": [
          "Final verification: All nodes converged to empty document after all operations"
        ]
      }
    },
    {
      "call": {
        "methodName": "is_empty",
        "argsJson": {},
        "expectedResultJson": true,
        "target": "allMembers",
        "description": [
          "Final verification: All nodes agree document is empty"
        ]
      }
    }
  ]
}
