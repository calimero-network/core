{
  "steps": [
    {
      "applicationInstall": {
        "application": {
          "localFile": "./apps/kv-store/res/kv-store-1.0.0.mpk"
        },
        "target": "inviter"
      }
    },
    {
      "contextCreate": null
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for context creation to propagate"
        ]
      }
    },
    {
      "contextInviteJoin": null
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 10000,
        "description": [
          "Wait for User 2 to join and sync_context_config to install bundle",
          "This includes blob sharing, bundle detection, and installation"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "test_key",
          "value": "test_value"
        },
        "expectedResultJson": null,
        "target": "invitees",
        "description": [
          "User 2 (invitee) sets a value - verifies bundle WASM is installed and working"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 5000,
        "description": [
          "Wait for state delta broadcast and sync"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "test_key"
        },
        "expectedResultJson": "test_value",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify User 2 can read the value (bundle WASM working)",
          "Verify User 1 can also read it (state sync working)"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "user1_key",
          "value": "user1_value"
        },
        "expectedResultJson": null,
        "target": "inviter",
        "description": [
          "User 1 sets a value"
        ]
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 5000,
        "description": [
          "Wait for state delta broadcast and sync"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "user1_key"
        },
        "expectedResultJson": "user1_value",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify both users can read User 1's value (bidirectional sync working)"
        ]
      }
    }
  ]
}

