{
  "steps": [
    {
      "applicationInstall": {
        "application": {
          "localFile": "./apps/kv-store/res/kv_store.wasm"
        },
        "target": "allMembers"
      }
    },
    {
      "contextCreate": null
    },
    {
      "contextCreateAlias": {
        "aliasName": "my_context"
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "foo",
          "value": "bar"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "bar",
        "target": "inviter"
      }
    },
    {
      "contextInviteJoin": null
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 1000,
        "description": [
          "Wait for nodes to join, subscribe to gossipsub, and sync state.",
          "Increased to 10s for CI environments which may be slower."
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "bar",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify all nodes have initial state 'bar'.",
          "Increased retries for CI: 30 attempts with 3s intervals = up to 90s.",
          "Smart peer selection should ensure nodes bootstrap from inviter."
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "foo",
          "value": "baz"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 1000,
        "description": [
          "Wait for gossipsub broadcast propagation and delta application.",
          "Increased to 8s for CI environments."
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "baz",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify updated state 'baz' synced to all nodes.",
          "Increased retries for CI: 20 attempts with 3s intervals = up to 60s."
        ]
      }
    }
  ]
}
