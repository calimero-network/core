{
  "steps": [
    {
      "applicationInstall": {
        "application": {
          "localFile": "./apps/kv-store/res/kv_store.wasm"
        },
        "target": "allMembers"
      }
    },
    {
      "contextCreate": null
    },
    {
      "contextCreateAlias": {
        "aliasName": "my_context"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for broadcast propagation (~6ms measured, 200ms for safety)"
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "foo",
          "value": "bar"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "bar",
        "target": "inviter"
      }
    },
    {
      "contextInviteJoin": null
    },
    {
      "wait": {
        "for": "consensus",
        "durationMs": 2000,
        "description": [
          "Wait for mesh formation + sync (~6ms measured, 1000ms for mesh + cascade)"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "bar",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify all nodes have initial state 'bar'.",
          "Increased retries for CI: 30 attempts with 3s intervals = up to 90s.",
          "Smart peer selection should ensure nodes bootstrap from inviter."
        ]
      }
    },
    {
      "call": {
        "methodName": "set",
        "argsJson": {
          "key": "foo",
          "value": "baz"
        },
        "expectedResultJson": null,
        "target": "inviter"
      }
    },
    {
      "wait": {
        "for": "broadcast",
        "durationMs": 500,
        "description": [
          "Wait for broadcast propagation (~6ms measured, 200ms for safety)"
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "baz",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify updated state 'baz' synced to all nodes.",
          "Increased retries for CI: 20 attempts with 3s intervals = up to 60s."
        ]
      }
    },
    {
      "call": {
        "methodName": "update_if_exists",
        "argsJson": {
          "key": "foo",
          "value": "qux"
        },
        "expectedResultJson": true,
        "target": "inviter",
        "description": [
          "Update existing key 'foo'. Should return true and emit Updated event."
        ]
      }
    },
    {
      "call": {
        "methodName": "update_if_exists",
        "argsJson": {
          "key": "missing_key",
          "value": "value"
        },
        "expectedResultJson": false,
        "target": "inviter",
        "description": [
          "Attempt to update non-existent key. Should return false and emit NO events."
        ]
      }
    },
    {
      "call": {
        "methodName": "get_or_insert",
        "argsJson": {
          "key": "foo",
          "value": "ignored_val"
        },
        "expectedResultJson": "qux",
        "target": "inviter",
        "description": [
          "Key 'foo' exists. Should return existing 'qux' and emit NO events."
        ]
      }
    },
    {
      "call": {
        "methodName": "get",
        "argsJson": {
          "key": "foo"
        },
        "expectedResultJson": "qux",
        "target": "allMembers",
        "retries": 5,
        "intervalMs": 1000,
        "description": [
          "Verify updated state 'qux' synced to all nodes.",
          "Increased retries for CI: 20 attempts with 3s intervals = up to 60s."
        ]
      }
    }
  ]
}
